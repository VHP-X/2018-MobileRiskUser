### 特征工程

参赛模型所用特征的一份整理。

这里所写特征都是最后提交模型中实际使用的，而一些尝试过而未添加到最终模型的特征保留在代码中以注释方式保留。



[TOC]



#### sms 表

##### `opp_num`

这个我感觉是非常难处理的， 因为被加密过， 其数据本身没有任何意义，只能从出现的频数上入手。

事实上对于这一类数据， 在这次比赛中我都有采用选取出现频次最多的前Top-K 做one-hot 作为特征。

1. 对于`sms`的`opp_num`,需要注意的一点是有两三个`opp_num`明显出现的频次远高于其他， 怀疑这是一个常用号码， 去掉这几个之后*cv*有所提升，因此最后选取的是出现频次在1000-3000的`opp_num`做为特征。
2. 由于`opp_num`取值种类非常多，直接one-hot显然不现实， 但是我们可以选取一些较为特殊的号码类做one-hot. 我选取的是号码长度（$opp\_len$）小于等于8  的号码做one-hot， 这样做的话， 特到的特征数不至于过多。当然也可以选取长号码（即$opp\_len > 12$) 的号码族， 但是我尝试之后发现cv结果显示并没有提高， 所以最后没有采用长号码分类作为特征。
3. 统计用户通信的不同号码数量（`unique num`)

**注：这部分特征全部都是分in， out分别统计，并且对于其中某些特征，in out的差值也作为特征加入**



##### `opp_head`

1. 考虑到这个变量的取值种类并不算太多， 因此直接对其做 *one-hot* 即可
2. 由于`opp_head`为000是国际电话，因此特意将其挑出来，做一个国际国内通话量统计
3. `opp_head`中还包含有运营商信息， 所以根据资料，对运营商做一个初略的分类统计次数，并作为特征
4.  统计用户通信的不同 `opp_head` 数量（`unique num`)

**注：这部分特征全部都是分in， out分别统计，并且对于其中某些特征，in out的差值也作为特征加入**



##### `opp_len`

1. 分类别统计。 分类别的两个分隔点：一个是$opp\_len= 5$， 另一个是$opp\_len= 11$， 统计的是每个类别的短信次数， 以及占总量的比重
2. 对`opp_len`直接做*one-hot*，每一个取值都作为一个特征，统计其频数

**这部分特征全部都是分in， out分别统计，并且对于其中某些特征，in out的差值也作为特征加入**



##### `start_time`

虽然这个数据精确到秒， 但是我觉得时，分，秒 用起来都不怎么有效（之前是做过对hour的特征提取，但是最后发现效果不好也没采用） 日期倒是一个不错的信息。

1. 用户按日统计的一些量。如用户的每日通话平均次数， 用户通话天数， 通话次数的方差等
2. 对日期做*bagging*， 比如每5天为一个bag， 再分类（一共$45 / 5 = 9$类）统计
3. 对日期直接做 *one-hot*， 把45天每天的短信次数都分别作为一维特征， 其他统计量(如标准差， 均值， 最大值等)也分别对应作为特征。

**这部分特征全部都是分in， out分别统计，并且对于其中某些特征，in out的差值也作为特征加入**



##### `in_out`

这部分单独做的特征， 其实只是分别统计了一下频数。 但是这部分信息贯穿了整个`sms`的特征中， 因为大部分特征提取都是对*in，out* 分别做的， 这其中还有一些特征是通过取*in，out*的差值得到的。



------

#### voice表

对于voice表， 其实里面有大量的特征提取方法和`sms`表相同（实际操作的时候基本代码直接复用，改几个变量名即可）

对于里面和`sms`表相同或者很相似的特征就不展开说明了， 主要说的会是一些不同的特征。



##### `opp_num`

对出现频次最多的*Top-K* 做*one-hot*， 选取*short num* （$opp\_len \le 5$）做*one-hot*， 做法与`sms`完全一致。

##### `opp_head`

对`opp_head`做*one-hot* ，区分国内外， 区分运营商，做法和`sms`表完全一致。

##### `opp_len`

对`opp_len`分类别和直接做*one-hot*， 处理方式和`sms`完全一致， 分类点也是相同的

##### `start_time & end_time`

这两个属性可以得到一个比较重要的量—— 通话时间，有一部分特征围绕这个量构造的

在只考虑start_time时， 处理方式和`sms`表是一致的，即考虑其日期，并构造按日期统计的量

1. 按日统计量， 对日期做*bagging*， 做*one-hot*。处理和`sms`一致。
2. 通话时长的相关统计量，如均值， 最大值， 中位数 等
3. 通话时长按日期的统计量。这个有一部分还是和上面的不相同的， 比如最大值， 方差等
4. 通话时长的分类统计。我一共分3类： 2min以内， 2-10min， 10min以上



##### `call_type`

call_type总共只有5个取值， 直接做*one-hot*即可， 注意也是区分*in out* 分别作为特征

##### `in_out`

同`sms`表，统计*in,out*的频数， 以及比重。



---------------

#### wa 表

##### `wa_name`

1. 访问的不同*web/app* 的数目

2. `wa_name`也是前面说的那种比较棘手的数据， 因此我也用了频次前 Top-K进行one-hot的方法

3. 这里`wa_name`并不是像`opp_num`那样毫无意义， 但是凭我的先验知识我不太能够发现`wa_name`和风险用户的关系， 所以我这里冒着过拟合的风险， 去统计了一下在训练集上， 那些经常被风险用户使用的app， 我称它们为“*bad app*”。 然后再以用户使用这些app或web的次数来构建特征。

   这个特征其实我自己也比较犹豫， 我的想法主要是， 在过拟合和获得一定先验知识之间做一个*trade-off*，而且后续通过控制模型参数（比如叶子节点数）可以起到控制过拟合的作用，加之这个特征组使我的模型在本地*cv*时效果是有一定提升的， 因此还是决定保留。

##### `visit_cnt`

1. 直接统计总和，方差等量
2. 按照日期归类后的常见统计量

注意也是分开 *web，app* 进行统计， 处理方式和 *in,out* 一致。

##### `visit_dura`

1. 直接统计量
2. 按照日期归类后的统计量
3. 按照访问时间的数量级进行分类，再进行统计。这里需要吐槽的一点是，很多条记录的`visit_dura`超过80000s...这种数据我感觉可能误统计率挺大， 所以也没有很仔细的在这块做特征...
4. 随意的做了一个平均访问时长的量， 即$\frac{visit\_dura}{visit\_cnt} $

##### `up_flow & down_flow`

除了计算一个总流量，这里很明显的一个量是上下行速度，可以直接用流量除时间得到。我的特征只是计算了上下行速度以及总速度。 但是现在整理的时候， 发现应该再对得到的速度再做一个分类比较合适。

##### `wa_type`

和前两张表的*in,out*一样处理方法， 虽然单独来看这个属性只统计了频数， 但是它也贯穿整个表的特征。

##### `date`

对于日期想法还是和前两张表一致，做*bagging*，但是我现在整理的时候才发现我似乎忘了做一个*one-hot*...

这里做*bagging*我分别对每个bag中， 流量占比， 流量使用次数占比， 访问时间占比做了统计。

其实我在做这里时，是希望有一个可以描述 *趋势* 的量来作为特征，这种 *趋势* 指的是 以时间为横轴， 需要做的统计量为纵轴， 画出来的一条折线的  不考虑具体值的  ”*形状*“，但是好像没有想到什么很好的量来描述， 所以只好选择用占比。

 